{% extends "../base.html" %} {% block title %}{{ other.username }} - {{
config.name }}{% endblock %} {% block head %}
<!-- prettier-ignore -->
{% if let Some(biography) = other.metadata.kv.get("sparkler:biography") %}
<meta name="og:title" content="{{ other.username }}" />
<meta name="og:url" content="{{ config.host }}/@{{ other.username }}" />

<meta property="og:type" content="profile" />
<meta property="profile:username" content="{{ other.username }}" />

<meta
    name="og:image"
    content="{{ config.host }}/api/v0/auth/profile/{{ other.id }}/avatar"
/>

<meta
    name="twitter:image"
    content="{{ config.host }}/api/v0/auth/profile/{{ other.id }}/avatar"
/>

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Ask me something!" />
<meta
    name="twitter:description"
    content="Ask @{{ other.username }} something on {{ config.name }}!"
/>

{% let biography = biography.replace("\"", "\\\\\"") %}
<meta name="description" content="{{ biography }}" />
<meta name="og:description" content="{{ biography }}" />
{% endif %} {% endblock %} {% block nav_left %} {% if profile.is_some() %}
<a class="button" href="/" title="Timeline">
    {{ icon "house" }}
    <span class="desktop">{{ text "general:link.timeline" }}</span>
    <span class="mobile">{{ text "general:link.home" }}</span>
</a>

<a class="button" href="/inbox" title="My inbox">
    {{ icon "inbox" }}
    <span class="flex items-center gap-2">
        <span>{{ text "general:link.inbox" }}</span>
        {% if unread != 0 %}
        <span class="notification tr">{{ unread }}</span>
        {% endif %}
    </span>
</a>
{% endif %} {% endblock %} {% block nav_right %} {% if profile.is_some() %}
<a class="button" href="/inbox/notifications" title="My notifications">
    {{ icon "bell" }} {% if notifs != 0 %}
    <span class="notification tr">{{ notifs }}</span>
    {% endif %}
</a>
{% endif %} {% endblock %} {% block content %}
<article id="editor">
    {{ other.layout.fill().as_ref().render_block()|safe }}
</article>

<!-- prettier-ignore -->
{% let as_json = serde_json::to_string(other.layout.fill().as_ref()).unwrap() %}
<script type="application/json" id="editor_json">
    {{ as_json|safe }}
</script>

<style>
    .layout_editor_block {
        width: 100%;
        padding: 1rem;
        background: var(--color-lowered);
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 0 2px var(--color-super-lowered);
        font-family: monospace;
        font-size: 16px;
        cursor: pointer !important;
        user-select: none;
        border-radius: var(--radius);
    }

    .layout_editor_block:hover {
        box-shadow: 0 0 0 2px var(--color-primary);
    }
</style>

<button
    class="big primary floating right permanent"
    title="Save"
    id="save"
    onclick="save_layout()"
>
    {{ icon "save" }}
</button>

<button
    class="big floating permanent red"
    title="Reset"
    id="reset"
    onclick="reset_layout()"
>
    {{ icon "trash" }}
</button>

{% let user = profile.as_ref().unwrap() %}
<script>
    require("LayoutEditor", (LayoutEditor) => {
        globalThis.editor = new LayoutEditor(
            document.getElementById("editor"),
            JSON.parse(document.getElementById("editor_json").innerHTML),
        );

        globalThis.save_layout = async () => {
            await trigger("app:debounce", ["settings:save_settings"]);
            const res = await (
                await fetch("/api/v0/auth/profile/{{ user.id }}/layout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        layout: globalThis.editor.json,
                    }),
                })
            ).json();

            trigger("app:toast", [
                res.success ? "success" : "error",
                res.success ? "Layout saved!" : res.message,
            ]);
        };

        globalThis.reset_layout = async () => {
            if (
                !(await trigger("app:confirm", [
                    "Are you sure you would like to do this? This will reset your layout to the default.",
                ]))
            ) {
                return;
            }

            globalThis.editor.json = { json: "default.json" };
            globalThis.editor.render();

            trigger("app:toast", [
                res.success ? "success" : "error",
                res.success ? "Layout reset!" : res.message,
            ]);
        };
    });

    window.addEventListener("beforeunload", (event) => {
        event.preventDefault();
        event.returnValue = true;
    });
</script>

<dialog id="editor_dialog">
    <div class="inner flex flex-col gap-2"></div>
</dialog>

<!-- prettier-ignore -->
{% if is_self %}
<div id="is_self"></div>
{% endif %} {% let raw_metadata =
crate::routing::pages::clean_metadata_raw(other.metadata) %} {% include
"components/theming.html" %} {% call super() %} {% endblock %}
