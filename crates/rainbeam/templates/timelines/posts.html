{% extends "base.html" %} {% block title %}{{ config.name }}{% endblock %} {%
block head %}
<meta name="description" content="{{ config.description }}" />
{% endblock %} {% block nav_left %}
<a class="button active" href="/" title="Timeline">
    <i class="icon" data-lucide="house"></i>
    <span class="desktop">Timeline</span>
    <span class="mobile">Home</span>
</a>

{% if profile.is_some() %}
<a class="button" href="/inbox" title="My inbox">
    <i class="icon" data-lucide="inbox"></i>
    <span class="flex items-center gap-2">
        <span>Inbox</span>
        {% if unread != 0 %}
        <span class="notification tr">{{ unread }}</span>
        {% endif %}
    </span>
</a>
{% endif %} {% endblock %} {% block nav_right %} {% if profile.is_some() %}
<a class="button" href="/inbox/notifications" title="My notifications">
    <i class="icon" data-lucide="bell"></i>
    {% if notifs != 0 %}
    <span class="notification tr">{{ notifs }}</span>
    {% endif %}
</a>
{% endif %} {% endblock %} {% block content %} {% if profile.is_none() %}
<script>
    document.querySelector("nav").remove();
</script>
{% endif %}

<article>
    {% if profile.is_some() %}
    <a
        href="/intents/post"
        title="New post"
        class="button primary floating right"
    >
        <i class="icon" data-lucide="plus"></i>
    </a>
    {% endif %}

    <main class="flex flex-col gap-2">
        {% if profile.is_some() %}
        <div class="pillmenu convertible">
            <a href="/"><span>Timeline</span></a>
            <a href="/inbox/posts" class="active"><span>Posts</span></a>
            <a href="/inbox/global"><span>Global</span></a>
        </div>

        <div class="pillmenu convertible">
            <a href="/inbox/posts" class="active"><span>Public</span></a>
            <a href="/inbox/posts/following"><span>Following</span></a>
        </div>
        {% endif %} {% if responses.len() == 0 %}
        <div class="markdown-alert-important">
            <span>No results matching this query yet!</span>
        </div>
        {% endif %}

        <div class="flex justify-between">
            <div></div>
            <div class="flex gap-2">
                {% if profile.is_some() %}
                <a href="/intents/post" class="button primary bold">
                    <i class="icon" data-lucide="plus"></i>
                    New
                </a>
                {% endif %}

                <a href="/search?driver=2" class="button secondary bold">
                    <i class="icon" data-lucide="search"></i>
                    Search
                </a>
            </div>
        </div>

        <!-- pagination buttons -->
        {% if page != 0 %}
        <div class="flex justify-center items-center gap-4 w-full">
            <a class="button primary" href="?page=0"> View full feed </a>
        </div>
        {% endif %}

        <!-- feed -->
        <div class="flex flex-col gap-4" id="feed">
            {% include "partials/timelines/posts.html" %}
        </div>
    </main>
</article>

<script>
    use("app", (app) => {
        app["hook.attach_to_partial"](
            "/_app/timelines/posts.html",
            "/inbox/posts",
            document.getElementById("feed"),
            document.body,
            parseInt("{{ page }}"),
        ).then(() => {
            console.log("partial end");
            document.getElementById("feed").innerHTML +=
                `<div class="w-full flex flex-col gap-2">
                <hr />
                <p class="w-full flex justify-center fade">
                    You've reached the end
                </p>
            </div>`;
        });
    });
</script>

{% if let Some(profile) = profile %} {% let other = profile.clone() %} {% if
profile.username == other.username %}
<div id="is_self"></div>
{% endif %} {% let raw_metadata =
crate::routing::pages::clean_metadata_raw(other.metadata) %} {% include
"components/theming.html" %} {% endif %} {% call super() %} {% endblock %}
