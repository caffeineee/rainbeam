<div
    class="flex justify-between items-center flex-collapse sm:items-start gap-1 response_title"
>
    <div class="footernav items-center flex-wrap">
        <b class="flex items-center gap-2">
            <a
                href="/@{{ response.author.username }}"
                style="color: inherit"
                class="username flex gap-2 items-center"
            >
                <img
                    title="{{ response.author.username }}'s avatar"
                    src="/api/v0/auth/profile/{{ response.author.id }}/avatar"
                    alt=""
                    class="avatar"
                    loading="lazy"
                    style="--size: 20px"
                />

                <!-- prettier-ignore -->
                {% let display_name = response.author.metadata.kv.get("sparkler:display_name") %}

                {% if let Some(display_name) = display_name %}
                    {% if !display_name.trim().is_empty() %}
                        {{ crate::routing::pages::escape_username(display_name) }}
                    {% else %}
                        {{ response.author.username }}
                    {% endif %}
                {% else %}
                    {{ response.author.username }}
                {% endif %}
            </a>
        </b>

        <span class="flex fade item">
            {% if (response.edited != 0) && (response.edited !=
            response.timestamp) %}
            <span class="date item">{{ response.edited }}</span>
            <sup title="Edited">*</sup>
            {% else %}
            <span class="date item">{{ response.timestamp }}</span>
            {% endif %}
        </span>

        {% if is_pinned == true %}
        <a
            class="item flex items-center justify-center icon-only button primary small"
            title="This question/response is pinned"
            href="/@{{ response.author.username }}"
        >
            {{ icon "pin" }}
        </a>
        {% endif %} {% if !response.context.circle.is_empty() %}
        <a
            class="button item primary icon-only small"
            href="/+g/{{ response.context.circle }}"
            title="Posted in circle"
        >
            {{ icon "users-round" }}
        </a>
        {% endif %}
    </div>

    {% if do_render_nested == true %}
    <div class="flex justify-between gap-2 sm:w-full actions_bar">
        <!-- reactions -->
        <button
            title="{{ reaction_count }} reactions"
            class="camo circle"
            onclick="trigger('reactions:toggle', ['{{ response.id }}', 'Response', event.target])"
            hook="check_reaction"
            hook-arg:id="{{ response.id }}"
        >
            {{ icon "heart" }} {% if reaction_count > 0 %}
            <span class="notification camo">{{ reaction_count }}</span>
            {% endif %}
        </button>

        <!-- comments -->
        {% if show_comments != false %}
        <a
            href="/response/{{ response.id }}"
            title="{{ comment_count }} comments"
            class="button camo circle"
        >
            {{ icon "message-circle" }} {% if comment_count > 0 %}
            <span class="notification camo">{{ comment_count }}</span>
            {% endif %}
        </a>
        {% endif %}

        <!-- quote -->
        <div class="dropdown">
            <button
                class="w-full camo circle"
                onclick="trigger('app:hook.dropdown', [event])"
                exclude="dropdown"
                title="Quote"
            >
                {{ icon "repeat-2" }}
            </button>

            <div class="inner shadow-md w-content" exclude="dropdown">
                {% if profile.is_some() %}
                <button
                    onclick="trigger('responses:create', ['0', 'âœ¨ Boost\n/+r/{{ response.id }}'])
                        .then((p) => {
                            p.success ? window.location.href = `/response/${p.payload.id}` : ''
                        })"
                >
                    {{ icon "rocket" }} Boost
                </button>

                <a
                    href="/intents/post?reply={{ response.id }}&title=Quote%20post"
                >
                    {{ icon "quote" }} Quote
                </a>
                {% endif %}

                <a
                    href="/@{{ response.author.username }}?reply_intent={{ response.id }}#top"
                    data-turbo="false"
                    target="_blank"
                >
                    {{ icon "reply" }} Ask about this
                </a>
            </div>
        </div>

        <!-- options -->
        <div class="dropdown">
            <button
                class="w-full camo circle"
                onclick="trigger('app:hook.dropdown', [event])"
                exclude="dropdown"
                title="More"
            >
                {{ icon "ellipsis" }}
            </button>

            <div class="inner shadow-md w-content" exclude="dropdown">
                <b class="title">Sharing</b>

                <!-- prettier-ignore -->
                {% let short_id = response.id[..10] %}

                <button
                    onclick="trigger('app:copy_text', [trigger('responses:gen_share', [event.target, '{{ short_id }}', 280])])"
                >
                    {{ icon "copy" }} Copy to Clipboard
                </button>

                <button
                    onclick="trigger('app:intent_twitter', [trigger('responses:gen_share', [event.target, '{{ short_id }}', 280, false]), '{{ config.host }}/+r/{{ short_id }}'])"
                >
                    {{ icon "twitter" }} Twitter
                </button>

                <button
                    onclick="trigger('app:intent_bluesky', [trigger('responses:gen_share', [event.target, '{{ short_id }}', 280, false]), '{{ config.host }}/+r/{{ short_id }}'])"
                >
                    {{ icon "external-link" }} Bluesky
                </button>

                <button
                    onclick="trigger('app:copy_text', ['{{ config.host }}/+r/{{ short_id }}'])"
                >
                    {{ icon "copy" }} Copy link
                </button>

                {% if let Some(profile) = profile %} {% if profile.id ==
                response.author.id %}
                <!-- actions for the profile owner only -->
                <b class="title">Manage</b>

                <!-- pin -->
                {% if show_pin_button == true %} {% if is_pinned == false %}
                <a href="#" onclick="pin_response('{{ response.id }}')">
                    {{ icon "pin" }} Pin
                </a>
                {% else %}
                <a href="#" onclick="unpin_response('{{ response.id }}')">
                    {{ icon "pin-off" }} Unpin
                </a>
                {% endif %} {% endif %}

                <!-- ... -->
                <a href="/response/{{ response.id }}?edit" target="_blank">
                    {{ icon "pen" }} Edit
                </a>

                <a href="/response/{{ response.id }}?edit_tags" target="_blank">
                    {{ icon "tag" }} Edit tags
                </a>

                {% if response.context.is_post == false %}
                <a
                    href="#"
                    onclick="trigger('responses:unsend', ['{{ response.id }}'])"
                    class="red"
                >
                    {{ icon "undo-2" }} Return to Inbox
                </a>
                {% endif %}

                <a
                    href="#"
                    onclick="trigger('responses:delete', ['{{ response.id }}'])"
                    class="red"
                >
                    {{ icon "trash" }} Delete all
                </a>
                {% endif %} {% endif %}
                <!-- actions for everybody -->
                <b class="title">Tools</b>
                <a
                    href="#"
                    onclick="trigger('app:copy_text', ['{{ config.citrus_id}}:{{ response.id }}'])"
                >
                    {{ icon "copy" }} Copy ID
                </a>

                <a href="/response/{{ response.id }}">
                    {{ icon "external-link" }} Open
                </a>

                {% if is_helper %}
                <a href="/question/{{ question.id }}">
                    {{ icon "external-link" }} Open question
                </a>
                {% endif %}

                <!-- prettier-ignore -->
                {% if let Some(profile) = profile %}
                {% if profile.id != response.author.id %}
                <!-- actions for users that ARE NOT the author -->
                <a
                    href="javascript:trigger('reports:bootstrap', ['responses', '{{ response.id }}'])"
                >
                    {{ icon "flag" }} Report
                </a>
                {% endif %} {% if is_helper %}
                <b class="title">Mod</b>
                <a
                    href="#"
                    onclick="trigger('responses:delete', ['{{ response.id }}'])"
                    class="red"
                >
                    {{ icon "trash" }} Delete
                </a>
                {% endif %} {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
